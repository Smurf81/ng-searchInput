/*! 
 * ng-inputSearch v0.0.1
 * 
 * Copyright (c) 2014 
 * License: 
 */
angular.module("ng.inputSearch",[]).directive("searchBar",["$timeout",function(a){var b=function(a){var b=angular.element("<div>");return a&&b.addClass(a),b},c=function(a,b){var c=a.find("ul")[0],d=c.children;return d[b]};return{restrict:"E",scope:{maxResults:"=",results:"=",searchQuery:"=",minCharSearch:"=",searchButton:"&",searchPartials:"&",actionOnElement:"&"},template:'<form class="form-inline"><div ng-init="warning=false" ng-show="warning && minCharSearch" class="alert alert-warning search-warning text-center"> Thank you to enter at least {{minCharSearch}} characters for your search.</div><div class="controls search"><div class="input-group col-sm-5 col-sm-offset-3 col-md-5 col-md-offset-3 col-lg-offset-4 col-lg-4 pull-left"><input type="text" size="50" class="form-control" ng-model="searchQuery" placeholder="Search"><div class="input-group-btn delete-button"><button type="button" class="btn btn-default" ng-click="deleteSearch($event)"><div>x</div></button></div></div><span class="center-text search-button" ng-click="searchButton()"><button type="submit" class="btn btn-primary btn-lg glyphicon glyphicon-search"></button></span><div class="dropdown" ng-class="{open:results !==undefined}"><ul class="col-sm-5 col-sm-offset-3 col-md-5 col-md-offset-3 col-lg-offset-4 col-lg-4 dropdown-menu " role="menu"><li ng-show="results.length > 0" ng-repeat="element in results | limitTo : maxResults "><result-element element="element" ng-click="actionOnElement({id:element.id})"></result-element></li><li ng-show="results.length > maxResults" class="text-center"><a ng-click="searchWithRedirect()" class="more-results">More results</a></li><li ng-show="results.length == 0" class="text-center"><span class="no-search-result">No results</span></li></ul></div></div></form>',replace:!0,link:function(d,e,f){d.maxResults=angular.isDefined(f.maxResults)?d.$parent.$eval(f.maxResults):5,d.minCharSearch=angular.isDefined(f.minCharSearch)?d.$parent.$eval(f.minCharSearch):3;var g;d.$watch("searchQuery",function(b){b&&b.length>=d.minCharSearch?(a.cancel(g),g=a(function(){d.searchPartials()},300)):(d.results=void 0,k=0)});var h=b("dialog-backdrop");d.$watch(function(){return d.results},function(a){a&&(e.parent().append(h),h.bind("click",function(){d.$apply(function(){d.results=void 0,k=0}),h.remove()}))}),d.deleteSearch=function(a){a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1,d.searchQuery="",d.results=void 0,k=0,e.find("input")[0].focus()};var i,j,k=-1;e.on("keydown",function(a){if(27===a.keyCode&&d.$apply(function(){d.results=void 0,k=0}),40===a.keyCode&&(0==k?i=c(e,k++):k<=d.maxResults&&k<d.results.length&&(i=c(e,k),j=c(e,k-1),k++,angular.element(j).removeClass("search-focus")),angular.isDefined(i)&&angular.element(i).addClass("search-focus")),38===a.keyCode&&(0!=k&&(k--,i=c(e,k-1),j=c(e,k),angular.element(j).removeClass("search-focus")),angular.element(i).addClass("search-focus")),13===a.keyCode)if(k>0&&k<d.maxResults+1){a.preventDefault();var b=d.results[k-1];d.$apply(function(){d.actionOnElement(b.id?{id:b.id}:{id:k-1})})}else d.$apply(function(){d.searchButton()})})}}}]).directive("resultElement",[function(){return{restrict:"EA",scope:{element:"="},replace:!0,templateUrl:"template/searchinput/element.html"}}]);